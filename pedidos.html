<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pedidos</title>

<style>
body {
    font-family: Arial, sans-serif;
    background: #f2f2f2;
    padding: 20px;
}

.card {
    background: white;
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 15px;
    cursor: pointer;
    box-shadow: 0 2px 5px rgba(0,0,0,.2);
}

.card h3 {
    margin: 0;
}

.details {
    display: none;
    margin-top: 10px;
}

.product {
    display: flex;
    align-items: center;
    margin-bottom: 8px;
}

.product img {
    width: 50px;
    height: 50px;
    margin-right: 10px;
}

button {
    padding: 10px;
    margin: 10px 0;
}
</style>
</head>

<body>

<h1>Pedidos Realizados</h1>

<button onclick="exportCSV()">Exportar a Excel</button>

<div id="listado"></div>

<button onclick="window.location.href='index.html'">Volver</button>

<script>
const pedidos = JSON.parse(localStorage.getItem('pedidos')) || [];
const contenedor = document.getElementById('listado');

pedidos.forEach((pedido, index) => {
    const card = document.createElement('div');
    card.className = 'card';

    card.innerHTML = `
        <h3>${pedido.cliente}</h3>
        <p>Código: ${pedido.codigo}</p>
        <p>${pedido.fecha}</p>

        <div class="details" id="d${index}">
            ${pedido.productos.map(p => `
                <div class="product">
                    <img src="pizza.png">
                    <div>
                        <strong>${p.name}</strong><br>
                        $${p.price}<br>
                        Código: ${pedido.codigo}
                    </div>
                </div>
            `).join('')}
        </div>
    `;

    card.onclick = () => {
        const d = document.getElementById('d' + index);
        d.style.display = d.style.display === 'block' ? 'none' : 'block';
    };

    contenedor.appendChild(card);
});

function exportCSV() {
    let csv = "Cliente,Código,Producto,Precio,Fecha\n";

    pedidos.forEach(p => {
        p.productos.forEach(prod => {
            csv += `${p.cliente},${p.codigo},${prod.name},${prod.price},${p.fecha}\n`;
        });
    });

    const blob = new Blob([csv], { type: 'text/csv' });
    const url = URL.createObjectURL(blob);

    const a = document.createElement('a');
    a.href = url;
    a.download = 'pedidos.csv';
    a.click();
}
</script>

</body>
</html>
